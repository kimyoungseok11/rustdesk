name: Windows Build

on:
    push:
        branches: [main]

jobs:
    build-windows:
        runs-on: windows-latest
        steps:
            - uses: actions/checkout@v4
              with:
                  submodules: recursive

            - uses: actions-rs/toolchain@v1
              with:
                  toolchain: stable
                  override: true

            - uses: subosito/flutter-action@v2
              with:
                  channel: stable

            - run: flutter config --enable-windows-desktop
            - run: cargo build --release
            - run: flutter build windows
              working-directory: flutter

            - uses: actions/upload-artifact@v4
              with:
                  name: rustdesk-windows
                  path: flutter/build/windows/runner/Release/
